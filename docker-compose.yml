version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: exchanger-server
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:3000"
    environment:
      - NODE_ENV=production
      - PORT=${PORT:-3000}
      - MONGODB=${MONGODB}
      - SECRET_ACCESS_JWT=${SECRET_ACCESS_JWT}
      - SECRET_REFRESH_JWT=${SECRET_REFRESH_JWT}
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - FRONTEND_URL=${FRONTEND_URL}
      - CLIENT_URL=${CLIENT_URL}
      - ADMIN_URL=${ADMIN_URL}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION}
      - AWS_BUCKET_NAME=${AWS_BUCKET_NAME}
    volumes:
      - ./logs:/app/logs
    depends_on:
      - mongodb
    networks:
      - app-network

  mongodb:
    image: mongo:6
    container_name: exchanger-mongodb
    restart: unless-stopped
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_USERNAME:-admin}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD:-password}
    volumes:
      - mongodb-data:/data/db
    networks:
      - app-network

  # Optional: Redis for caching
  # redis:
  #   image: redis:7-alpine
  #   container_name: exchanger-redis
  #   restart: unless-stopped
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - app-network

volumes:
  mongodb-data:
  # redis-data:

networks:
  app-network:
    driver: bridge
